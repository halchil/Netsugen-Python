# ライブラリの組み合わせ実践 - 4つのライブラリを一緒に使おう

## 1. はじめに

この章では、NumPy、Pandas、Matplotlib、Seabornを組み合わせて使う方法を学びます。
実際のデータ分析では、これらのライブラリを一緒に使うことが多いです。

## 2. まずは全てのライブラリをインポートしてみよう

```python
# 必要なライブラリを全てインポート
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定（Windows）
plt.rcParams['font.family'] = 'MS Gothic'

print("全てのライブラリをインポートしました！")
```

**実行してみてください：**
- エラーが出なければ成功です
- エラーが出た場合は、不足しているライブラリをインストールしてください

## 3. 最初の一歩：簡単なデータ分析をしてみよう

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# 1. NumPyでデータを作成
np.random.seed(42)
ages = np.random.normal(30, 8, 100)  # 年齢データ
salaries = np.random.normal(400000, 80000, 100)  # 給与データ

# 2. Pandasでデータフレームを作成
data = {
    '年齢': ages,
    '給与': salaries,
    '部署': np.random.choice(['営業部', '開発部', '人事部'], 100)
}
df = pd.DataFrame(data)

# 3. データの基本情報を表示
print("データの基本情報:")
print(df.info())
print("\n最初の5行:")
print(df.head())

# 4. 基本的な統計を表示
print("\n年齢の統計:")
print(df['年齢'].describe())

print("\n給与の統計:")
print(df['給与'].describe())
```

## 4. データの可視化をしてみよう

### 4.1 年齢分布の可視化

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# サンプルデータを作成
np.random.seed(42)
data = {
    '年齢': np.random.normal(30, 8, 100),
    '給与': np.random.normal(400000, 80000, 100),
    '部署': np.random.choice(['営業部', '開発部', '人事部'], 100)
}
df = pd.DataFrame(data)

# 図のサイズを設定
plt.figure(figsize=(12, 4))

# 1. Matplotlibでヒストグラム
plt.subplot(1, 2, 1)
plt.hist(df['年齢'], bins=20, alpha=0.7, color='skyblue', edgecolor='black')
plt.title('年齢分布（Matplotlib）')
plt.xlabel('年齢')
plt.ylabel('人数')

# 2. Seabornでヒストグラム
plt.subplot(1, 2, 2)
sns.histplot(data=df, x='年齢', bins=20, color='lightgreen')
plt.title('年齢分布（Seaborn）')
plt.xlabel('年齢')
plt.ylabel('人数')

plt.tight_layout()
plt.show()
```

### 4.2 部署別の給与分布

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# サンプルデータを作成
np.random.seed(42)
data = {
    '年齢': np.random.normal(30, 8, 100),
    '給与': np.random.normal(400000, 80000, 100),
    '部署': np.random.choice(['営業部', '開発部', '人事部'], 100)
}
df = pd.DataFrame(data)

# 図のサイズを設定
plt.figure(figsize=(15, 5))

# 1. 部署別の箱ひげ図（Seaborn）
plt.subplot(1, 3, 1)
sns.boxplot(data=df, x='部署', y='給与')
plt.title('部署別給与分布（箱ひげ図）')
plt.xlabel('部署')
plt.ylabel('給与（円）')

# 2. 部署別の棒グラフ（Matplotlib）
plt.subplot(1, 3, 2)
dept_salary = df.groupby('部署')['給与'].mean()
plt.bar(dept_salary.index, dept_salary.values, color=['red', 'blue', 'green'])
plt.title('部署別平均給与（棒グラフ）')
plt.xlabel('部署')
plt.ylabel('平均給与（円）')

# 3. 年齢と給与の散布図（Seaborn）
plt.subplot(1, 3, 3)
sns.scatterplot(data=df, x='年齢', y='給与', hue='部署', alpha=0.7)
plt.title('年齢と給与の関係')
plt.xlabel('年齢')
plt.ylabel('給与（円）')

plt.tight_layout()
plt.show()
```

## 5. より高度な分析をしてみよう

### 5.1 相関分析と可視化

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# サンプルデータを作成
np.random.seed(42)
data = {
    '年齢': np.random.normal(30, 8, 100),
    '給与': np.random.normal(400000, 80000, 100),
    '勤続年数': np.random.exponential(5, 100),
    'パフォーマンス': np.random.normal(75, 15, 100),
    '部署': np.random.choice(['営業部', '開発部', '人事部'], 100)
}
df = pd.DataFrame(data)

# 1. 相関行列の計算（NumPy）
numeric_cols = ['年齢', '給与', '勤続年数', 'パフォーマンス']
correlation_matrix = df[numeric_cols].corr()

# 2. 相関行列の可視化（Seaborn）
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', center=0, 
            square=True, fmt='.2f')
plt.title('相関行列')
plt.show()

# 3. 散布図行列（Seaborn）
plt.figure(figsize=(12, 10))
sns.pairplot(df[numeric_cols], diag_kind='hist')
plt.suptitle('散布図行列', y=1.02)
plt.show()
```

### 5.2 部署別の詳細分析

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# サンプルデータを作成
np.random.seed(42)
data = {
    '年齢': np.random.normal(30, 8, 100),
    '給与': np.random.normal(400000, 80000, 100),
    '勤続年数': np.random.exponential(5, 100),
    'パフォーマンス': np.random.normal(75, 15, 100),
    '部署': np.random.choice(['営業部', '開発部', '人事部'], 100)
}
df = pd.DataFrame(data)

# 1. 部署別の統計情報（Pandas）
print("部署別の統計情報:")
dept_stats = df.groupby('部署').agg({
    '年齢': ['mean', 'std', 'count'],
    '給与': ['mean', 'std'],
    'パフォーマンス': ['mean', 'std']
}).round(2)
print(dept_stats)

# 2. 部署別の可視化
plt.figure(figsize=(15, 10))

# 年齢分布
plt.subplot(2, 3, 1)
for dept in df['部署'].unique():
    dept_data = df[df['部署'] == dept]['年齢']
    plt.hist(dept_data, alpha=0.7, label=dept, bins=15)
plt.title('部署別年齢分布')
plt.xlabel('年齢')
plt.ylabel('人数')
plt.legend()

# 給与分布
plt.subplot(2, 3, 2)
for dept in df['部署'].unique():
    dept_data = df[df['部署'] == dept]['給与']
    plt.hist(dept_data, alpha=0.7, label=dept, bins=15)
plt.title('部署別給与分布')
plt.xlabel('給与（円）')
plt.ylabel('人数')
plt.legend()

# パフォーマンス分布
plt.subplot(2, 3, 3)
for dept in df['部署'].unique():
    dept_data = df[df['部署'] == dept]['パフォーマンス']
    plt.hist(dept_data, alpha=0.7, label=dept, bins=15)
plt.title('部署別パフォーマンス分布')
plt.xlabel('パフォーマンス')
plt.ylabel('人数')
plt.legend()

# 年齢と給与の関係（部署別）
plt.subplot(2, 3, 4)
sns.scatterplot(data=df, x='年齢', y='給与', hue='部署', alpha=0.7)
plt.title('年齢と給与の関係（部署別）')

# 勤続年数とパフォーマンスの関係
plt.subplot(2, 3, 5)
sns.scatterplot(data=df, x='勤続年数', y='パフォーマンス', hue='部署', alpha=0.7)
plt.title('勤続年数とパフォーマンスの関係')

# 部署別の箱ひげ図（給与）
plt.subplot(2, 3, 6)
sns.boxplot(data=df, x='部署', y='給与')
plt.title('部署別給与分布（箱ひげ図）')

plt.tight_layout()
plt.show()
```

## 6. 実践的な分析例

### 6.1 従業員分析レポートの作成

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# サンプルデータを作成
np.random.seed(42)
data = {
    '従業員ID': range(1, 101),
    '名前': [f'従業員{i:03d}' for i in range(1, 101)],
    '年齢': np.random.normal(30, 8, 100).astype(int),
    '給与': np.random.normal(400000, 80000, 100).astype(int),
    '勤続年数': np.random.exponential(5, 100).astype(int),
    'パフォーマンス': np.random.normal(75, 15, 100).round(1),
    '部署': np.random.choice(['営業部', '開発部', '人事部', '経理部'], 100)
}
df = pd.DataFrame(data)

# 1. 全体概要の表示
print("=== 従業員分析レポート ===")
print(f"総従業員数: {len(df)}人")
print(f"平均年齢: {df['年齢'].mean():.1f}歳")
print(f"平均給与: {df['給与'].mean():,.0f}円")
print(f"平均パフォーマンス: {df['パフォーマンス'].mean():.1f}点")

# 2. 部署別分析
print("\n=== 部署別分析 ===")
dept_analysis = df.groupby('部署').agg({
    '従業員ID': 'count',
    '年齢': 'mean',
    '給与': 'mean',
    'パフォーマンス': 'mean'
}).round(2)
dept_analysis.columns = ['従業員数', '平均年齢', '平均給与', '平均パフォーマンス']
print(dept_analysis)

# 3. 高パフォーマンス従業員の分析
print("\n=== 高パフォーマンス従業員分析 ===")
high_perf = df[df['パフォーマンス'] >= 80]
print(f"高パフォーマンス従業員数: {len(high_perf)}人 ({len(high_perf)/len(df)*100:.1f}%)")
print(f"高パフォーマンス従業員の平均年齢: {high_perf['年齢'].mean():.1f}歳")
print(f"高パフォーマンス従業員の平均給与: {high_perf['給与'].mean():,.0f}円")

# 4. 可視化
plt.figure(figsize=(15, 10))

# 年齢分布
plt.subplot(2, 3, 1)
sns.histplot(data=df, x='年齢', bins=20, color='skyblue')
plt.title('年齢分布')

# 給与分布
plt.subplot(2, 3, 2)
sns.histplot(data=df, x='給与', bins=20, color='lightgreen')
plt.title('給与分布')

# パフォーマンス分布
plt.subplot(2, 3, 3)
sns.histplot(data=df, x='パフォーマンス', bins=20, color='lightcoral')
plt.title('パフォーマンス分布')

# 部署別従業員数
plt.subplot(2, 3, 4)
dept_counts = df['部署'].value_counts()
plt.bar(dept_counts.index, dept_counts.values, color=['red', 'blue', 'green', 'orange'])
plt.title('部署別従業員数')
plt.xticks(rotation=45)

# 年齢と給与の関係
plt.subplot(2, 3, 5)
sns.scatterplot(data=df, x='年齢', y='給与', alpha=0.7)
plt.title('年齢と給与の関係')

# 部署別給与分布
plt.subplot(2, 3, 6)
sns.boxplot(data=df, x='部署', y='給与')
plt.title('部署別給与分布')
plt.xticks(rotation=45)

plt.tight_layout()
plt.show()
```

## 7. 練習問題

### 練習1: 自分のデータで分析してみよう

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 日本語フォントの設定
plt.rcParams['font.family'] = 'MS Gothic'

# あなたの好きなデータでデータフレームを作ってください
my_data = {
    '名前': ['A', 'B', 'C', 'D', 'E'],
    '値1': [10, 20, 15, 25, 30],
    '値2': [5, 15, 10, 20, 25],
    'カテゴリ': ['X', 'Y', 'X', 'Y', 'X']
}
df = pd.DataFrame(my_data)

# 1. データの基本情報を表示
print("データの基本情報:")
print(df.info())
print("\n最初の3行:")
print(df.head(3))

# 2. 基本的な統計を表示
print("\n値1の統計:")
print(df['値1'].describe())

# 3. カテゴリ別の分析
print("\nカテゴリ別の値1の平均:")
print(df.groupby('カテゴリ')['値1'].mean())

# 4. 可視化
plt.figure(figsize=(12, 4))

# 値1の分布
plt.subplot(1, 3, 1)
sns.histplot(data=df, x='値1', bins=5, color='skyblue')
plt.title('値1の分布')

# 値1と値2の関係
plt.subplot(1, 3, 2)
sns.scatterplot(data=df, x='値1', y='値2', color='red')
plt.title('値1と値2の関係')

# カテゴリ別の値1
plt.subplot(1, 3, 3)
sns.boxplot(data=df, x='カテゴリ', y='値1')
plt.title('カテゴリ別値1分布')

plt.tight_layout()
plt.show()
```

## 8. よくあるエラーと対処法

### エラー1: ライブラリがインストールされていない
```
ModuleNotFoundError: No module named 'numpy'
```
**対処法：** 必要なライブラリをインストール
```bash
pip install numpy pandas matplotlib seaborn
```

### エラー2: 日本語が表示されない
```python
plt.title('日本語タイトル')  # 文字化けする
```
**対処法：** フォント設定を追加
```python
plt.rcParams['font.family'] = 'MS Gothic'  # Windows
plt.title('日本語タイトル')
```

### エラー3: データ型の不一致
```python
df['年齢'].mean()  # エラー！年齢が文字列の場合
```
**対処法：** データ型を確認して変換
```python
print(df['年齢'].dtype)  # データ型を確認
df['年齢'] = pd.to_numeric(df['年齢'], errors='coerce')  # 数値に変換
```

## 9. まとめ

この章で学んだこと：
- 4つのライブラリの組み合わせ方
- データの作成から分析、可視化までの一連の流れ
- 実践的なデータ分析の方法
- エラーの対処法

次のステップ：
- より複雑なデータ分析
- 機械学習との組み合わせ
- データの読み込みと保存
- インタラクティブな可視化

**重要：** 実際にコードを実行してみることが大切です！ 